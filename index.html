<script>
  const csvUrl =
    "https://raw.githubusercontent.com/EricAGonzalz/CFBRankings/main/Dec7%20CFB%20Rankings.csv";

  function parseCSV(text) {
    const lines = text.trim().split("\n");
    const header = lines[0].split(",");
    const rows = lines.slice(1).map(line => line.split(","));
    return { header, rows };
  }

  function buildTable(header, rows) {
    const table = document.getElementById("rankings");
    const thead = table.querySelector("thead");
    const tbody = table.querySelector("tbody");

    const headerRow = document.createElement("tr");
    header.forEach((col, idx) => {
      const th = document.createElement("th");
      th.textContent = col;
      th.classList.add("sortable");
      th.dataset.index = idx;
      headerRow.appendChild(th);
    });
    thead.appendChild(headerRow);

    rows.forEach(cells => {
      if (!cells.join("").trim()) return;
      const tr = document.createElement("tr");
      cells.forEach(cell => {
        const td = document.createElement("td");
        td.textContent = cell;
        tr.appendChild(td);
      });
      tbody.appendChild(tr);
    });

    makeSortable(table);
  }

  function makeSortable(table) {
    const ths = table.querySelectorAll("th.sortable");
    ths.forEach(th => {
      th.addEventListener("click", () => {
        const index = parseInt(th.dataset.index, 10);
        const tbody = table.querySelector("tbody");
        const rows = Array.from(tbody.querySelectorAll("tr"));
        const current = th.dataset.sort || "none";
        const next = current === "asc" ? "desc" : "asc";
        ths.forEach(h => h.dataset.sort = "none");
        th.dataset.sort = next;

        rows.sort((a, b) => {
          const aText = a.children[index].textContent;
          const bText = b.children[index].textContent;

          const aNum = parseFloat(aText);
          const bNum = parseFloat(bText);
          const bothNumeric = !Number.isNaN(aNum) && !Number.isNaN(bNum);

          let cmp;
          if (bothNumeric) {
            cmp = aNum - bNum;
          } else {
            cmp = aText.localeCompare(bText);
          }
          return next === "asc" ? cmp : -cmp;
        });

        rows.forEach(r => tbody.appendChild(r));
      });
    });
  }

  fetch(csvUrl)
    .then(r => r.text())
    .then(text => {
      const { header, rows } = parseCSV(text);
      buildTable(header, rows);
    })
    .catch(err => {
      console.error("Failed to load CSV:", err);
    });
</script>
